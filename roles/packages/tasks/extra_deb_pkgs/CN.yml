---

# TODO: Find a reliable way of installing these packages in China without having
# to commit binary files into git.
# These .deb files are generated using dpkg-repack from a valid installation.
- name: install packages from checked-in .deb files
  become: true
  apt:
      deb: "{{ item }}"
  with_fileglob:
      - "{{ role_path }}/files/*.deb"

- name: configure npm source
  become: true
  command: npm config set registry https://registry.npm.taobao.org

- name: mkdir -p ~/.pip
  file:
      path: "{{ lookup('env', 'HOME') }}/.pip"
      state: directory

- name: configure pypi source
  copy:
      src: "{{ role_path }}/files/pip.conf-CN"
      dest: "{{ lookup('env', 'HOME') }}/.pip/pip.conf"
